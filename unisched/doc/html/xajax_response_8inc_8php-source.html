<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>University Scheduling System: C:/xampp/htdocs/uss2/lib/xajaxResponse.inc.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>C:/xampp/htdocs/uss2/lib/xajaxResponse.inc.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00037"></a>00037 <span class="comment">/*</span>
<a name="l00038"></a>00038 <span class="comment">   ----------------------------------------------------------------------------</span>
<a name="l00039"></a>00039 <span class="comment">   | Online documentation for this class is available on the xajax wiki at:   |</span>
<a name="l00040"></a>00040 <span class="comment">   | http://wiki.xajaxproject.org/Documentation:xajaxResponse.inc.php         |</span>
<a name="l00041"></a>00041 <span class="comment">   ----------------------------------------------------------------------------</span>
<a name="l00042"></a>00042 <span class="comment">*/</span>
<a name="l00043"></a>00043 
<a name="l00068"></a>00068 <span class="keyword">class </span>xajaxResponse
<a name="l00069"></a>00069 {
<a name="l00076"></a>00076         var $aCommands;
<a name="l00080"></a>00080         var $xml;
<a name="l00084"></a>00084         var $sEncoding;
<a name="l00089"></a>00089         var $bOutputEntities;
<a name="l00090"></a>00090 
<a name="l00106"></a>00106         function xajaxResponse($sEncoding=XAJAX_DEFAULT_CHAR_ENCODING, $bOutputEntities=<span class="keyword">false</span>)
<a name="l00107"></a>00107         {
<a name="l00108"></a>00108                 $this-&gt;setCharEncoding($sEncoding);
<a name="l00109"></a>00109                 $this-&gt;bOutputEntities = $bOutputEntities;
<a name="l00110"></a>00110                 $this-&gt;aCommands = array();
<a name="l00111"></a>00111         }
<a name="l00112"></a>00112         
<a name="l00122"></a>00122         function setCharEncoding($sEncoding)
<a name="l00123"></a>00123         {
<a name="l00124"></a>00124                 $this-&gt;sEncoding = $sEncoding;
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126         
<a name="l00132"></a>00132         function setOutputEntities($bOption)
<a name="l00133"></a>00133         {
<a name="l00134"></a>00134                 $this-&gt;bOutputEntities = (boolean)$bOption;
<a name="l00135"></a>00135                 <span class="keywordflow">return</span> $this;
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137         
<a name="l00142"></a>00142         function outputEntitiesOn()
<a name="l00143"></a>00143         {
<a name="l00144"></a>00144                 <span class="keywordflow">return</span> ($this-&gt;setOutputEntities(<span class="keyword">true</span>));
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146         
<a name="l00151"></a>00151         function outputEntitiesOff()
<a name="l00152"></a>00152         {
<a name="l00153"></a>00153                 <span class="keywordflow">return</span> ($this-&gt;setOutputEntities(<span class="keyword">false</span>));
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155 
<a name="l00165"></a>00165         function addConfirmCommands($iCmdNumber, $sMessage)
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'cc'</span>,<span class="charliteral">'t'</span>=&gt;$iCmdNumber),$sMessage);
<a name="l00168"></a>00168             <span class="keywordflow">return</span> $this;
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170         
<a name="l00171"></a>00171         function confirmCommands($iCmdNumber, $sMessage)
<a name="l00172"></a>00172         {
<a name="l00173"></a>00173                 <span class="keywordflow">return</span> $this-&gt;addConfirmCommands($iCmdNumber, $sMessage);
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175         
<a name="l00186"></a>00186         function addAssign($sTarget,$sAttribute,$sData)
<a name="l00187"></a>00187         {
<a name="l00188"></a>00188                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'as'</span>,<span class="charliteral">'t'</span>=&gt;$sTarget,<span class="charliteral">'p'</span>=&gt;$sAttribute),$sData);
<a name="l00189"></a>00189                 <span class="keywordflow">return</span> $this;
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191         
<a name="l00192"></a>00192         function assign($sTarget,$sAttribute,$sData)
<a name="l00193"></a>00193         {
<a name="l00194"></a>00194                 <span class="keywordflow">return</span> $this-&gt;addAssign($sTarget,$sAttribute,$sData);
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196 
<a name="l00207"></a>00207         function addAppend($sTarget,$sAttribute,$sData)
<a name="l00208"></a>00208         {       
<a name="l00209"></a>00209                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'ap'</span>,<span class="charliteral">'t'</span>=&gt;$sTarget,<span class="charliteral">'p'</span>=&gt;$sAttribute),$sData);
<a name="l00210"></a>00210                 <span class="keywordflow">return</span> $this;
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212         
<a name="l00213"></a>00213         function append($sTarget,$sAttribute,$sData)
<a name="l00214"></a>00214         {
<a name="l00215"></a>00215                 <span class="keywordflow">return</span> $this-&gt;addAppend($sTarget,$sAttribute,$sData);
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217 
<a name="l00229"></a>00229         function addPrepend($sTarget,$sAttribute,$sData)
<a name="l00230"></a>00230         {
<a name="l00231"></a>00231                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'pp'</span>,<span class="charliteral">'t'</span>=&gt;$sTarget,<span class="charliteral">'p'</span>=&gt;$sAttribute),$sData);
<a name="l00232"></a>00232                 <span class="keywordflow">return</span> $this;
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234         
<a name="l00235"></a>00235         function prepend($sTarget,$sAttribute,$sData)
<a name="l00236"></a>00236         {
<a name="l00237"></a>00237                 <span class="keywordflow">return</span> $this-&gt;addPrepend($sTarget,$sAttribute,$sData);
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239 
<a name="l00252"></a>00252         function addReplace($sTarget,$sAttribute,$sSearch,$sData)
<a name="l00253"></a>00253         {
<a name="l00254"></a>00254                 $aData[] = array(<span class="charliteral">'k'</span>=&gt;<span class="charliteral">'s'</span>,<span class="charliteral">'v'</span>=&gt;$sSearch);
<a name="l00255"></a>00255                 $aData[] = array(<span class="charliteral">'k'</span>=&gt;<span class="charliteral">'r'</span>,<span class="charliteral">'v'</span>=&gt;$sData);
<a name="l00256"></a>00256                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'rp'</span>,<span class="charliteral">'t'</span>=&gt;$sTarget,<span class="charliteral">'p'</span>=&gt;$sAttribute),$aData);
<a name="l00257"></a>00257                 <span class="keywordflow">return</span> $this;
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260         function replace($sTarget,$sAttribute,$sSearch,$sData)
<a name="l00261"></a>00261         {
<a name="l00262"></a>00262                 <span class="keywordflow">return</span> $this-&gt;addReplace($sTarget,$sAttribute,$sSearch,$sData);
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264 
<a name="l00274"></a>00274         function addClear($sTarget,$sAttribute)
<a name="l00275"></a>00275         {
<a name="l00276"></a>00276                 $this-&gt;assign($sTarget,$sAttribute,<span class="stringliteral">''</span>);
<a name="l00277"></a>00277                 <span class="keywordflow">return</span> $this;
<a name="l00278"></a>00278         }
<a name="l00279"></a>00279         
<a name="l00280"></a>00280         function clear($sTarget,$sAttribute)
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282                 <span class="keywordflow">return</span> $this-&gt;addClear($sTarget,$sAttribute);
<a name="l00283"></a>00283         }
<a name="l00284"></a>00284         
<a name="l00292"></a>00292         function addAlert($sMsg)
<a name="l00293"></a>00293         {
<a name="l00294"></a>00294                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'al'</span>),$sMsg);
<a name="l00295"></a>00295                 <span class="keywordflow">return</span> $this;
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297         
<a name="l00298"></a>00298         function alert($sMsg)
<a name="l00299"></a>00299         {
<a name="l00300"></a>00300                 <span class="keywordflow">return</span> $this-&gt;addAlert($sMsg);
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302 
<a name="l00310"></a>00310         function addRedirect($sURL, $iDelay=0)
<a name="l00311"></a>00311         {
<a name="l00312"></a>00312                 <span class="comment">//we need to parse the query part so that the values are rawurlencode()'ed</span>
<a name="l00313"></a>00313                 <span class="comment">//can't just use parse_url() cos we could be dealing with a relative URL which</span>
<a name="l00314"></a>00314                 <span class="comment">//  parse_url() can't deal with.</span>
<a name="l00315"></a>00315                 $queryStart = strpos($sURL, <span class="charliteral">'?'</span>, strrpos($sURL, <span class="charliteral">'/'</span>));
<a name="l00316"></a>00316                 <span class="keywordflow">if</span> ($queryStart !== FALSE)
<a name="l00317"></a>00317                 {
<a name="l00318"></a>00318                         $queryStart++;
<a name="l00319"></a>00319                         $queryEnd = strpos($sURL, <span class="charliteral">'#'</span>, $queryStart);
<a name="l00320"></a>00320                         <span class="keywordflow">if</span> ($queryEnd === FALSE)
<a name="l00321"></a>00321                                 $queryEnd = strlen($sURL);
<a name="l00322"></a>00322                         $queryPart = substr($sURL, $queryStart, $queryEnd-$queryStart);
<a name="l00323"></a>00323                         parse_str($queryPart, $queryParts);
<a name="l00324"></a>00324                         $newQueryPart = <span class="stringliteral">""</span>;
<a name="l00325"></a>00325                         <span class="keywordflow">if</span> ($queryParts)
<a name="l00326"></a>00326                         {
<a name="l00327"></a>00327                                 $first = <span class="keyword">true</span>;
<a name="l00328"></a>00328                                 <span class="keywordflow">foreach</span>($queryParts as $key =&gt; $value)
<a name="l00329"></a>00329                                 {
<a name="l00330"></a>00330                                         <span class="keywordflow">if</span> ($first)
<a name="l00331"></a>00331                                                 $first = <span class="keyword">false</span>;
<a name="l00332"></a>00332                                         <span class="keywordflow">else</span>
<a name="l00333"></a>00333                                                 $newQueryPart .= ini_get(<span class="stringliteral">'arg_separator.output'</span>);
<a name="l00334"></a>00334                                         $newQueryPart .= rawurlencode($key).<span class="charliteral">'='</span>.rawurlencode($value);
<a name="l00335"></a>00335                                 }
<a name="l00336"></a>00336                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($_SERVER[<span class="stringliteral">'QUERY_STRING'</span>]) {
<a name="l00337"></a>00337                                 <span class="comment">//couldn't break up the query, but there's one there</span>
<a name="l00338"></a>00338                                 <span class="comment">//possibly "http://url/page.html?query1234" type of query?</span>
<a name="l00339"></a>00339                                 <span class="comment">//just encode it and hope it works</span>
<a name="l00340"></a>00340                                 $newQueryPart = rawurlencode($_SERVER[<span class="stringliteral">'QUERY_STRING'</span>]);
<a name="l00341"></a>00341                         }
<a name="l00342"></a>00342                         $sURL = str_replace($queryPart, $newQueryPart, $sURL);
<a name="l00343"></a>00343                 }
<a name="l00344"></a>00344                 <span class="keywordflow">if</span> ($iDelay)
<a name="l00345"></a>00345                         $this-&gt;addScript(<span class="stringliteral">'window.setTimeout("window.location = \''</span>.$sURL.<span class="charliteral">'\'</span>;<span class="stringliteral">",'.($iDelay*1000).');');</span>
<a name="l00346"></a>00346 <span class="stringliteral">                else</span>
<a name="l00347"></a>00347 <span class="stringliteral">                        $this-&gt;addScript('window.location = "</span><span class="stringliteral">'.$sURL.'</span><span class="stringliteral">";');</span>
<a name="l00348"></a>00348 <span class="stringliteral">                return $this;</span>
<a name="l00349"></a>00349 <span class="stringliteral">        }</span>
<a name="l00350"></a>00350 <span class="stringliteral">        </span>
<a name="l00351"></a>00351 <span class="stringliteral">        function redirect($sURL, $iDelay=0)</span>
<a name="l00352"></a>00352 <span class="stringliteral">        {</span>
<a name="l00353"></a>00353 <span class="stringliteral">                return $this-&gt;addRedirect($sURL, $iDelay);</span>
<a name="l00354"></a>00354 <span class="stringliteral">        }</span>
<a name="l00355"></a>00355 <span class="stringliteral"></span>
<a name="l00363"></a>00363 <span class="stringliteral">        function addScript($sJS)</span>
<a name="l00364"></a>00364 <span class="stringliteral">        {</span>
<a name="l00365"></a>00365 <span class="stringliteral">                $this-&gt;addCommand(array('n'=&gt;'js'),$sJS);</span>
<a name="l00366"></a>00366 <span class="stringliteral">                return $this;</span>
<a name="l00367"></a>00367 <span class="stringliteral">        }</span>
<a name="l00368"></a>00368 <span class="stringliteral">        </span>
<a name="l00369"></a>00369 <span class="stringliteral">        function script($sJS)</span>
<a name="l00370"></a>00370 <span class="stringliteral">        {</span>
<a name="l00371"></a>00371 <span class="stringliteral">                return $this-&gt;addScript($sJS);</span>
<a name="l00372"></a>00372 <span class="stringliteral">        }</span>
<a name="l00373"></a>00373 <span class="stringliteral"></span>
<a name="l00382"></a>00382 <span class="stringliteral">        function addScriptCall()</span>
<a name="l00383"></a>00383 <span class="stringliteral">        {</span>
<a name="l00384"></a>00384 <span class="stringliteral">                $aArgs = func_get_args();</span>
<a name="l00385"></a>00385 <span class="stringliteral">            $sFunc = array_shift($aArgs);</span>
<a name="l00386"></a>00386 <span class="stringliteral">            $aData = $this-&gt;_buildObj($aArgs);</span>
<a name="l00387"></a>00387 <span class="stringliteral">            $this-&gt;addCommand(array('n'=&gt;'jc','t'=&gt;$sFunc),$aData);</span>
<a name="l00388"></a>00388 <span class="stringliteral">            return $this;</span>
<a name="l00389"></a>00389 <span class="stringliteral">        }</span>
<a name="l00390"></a>00390 <span class="stringliteral">        </span>
<a name="l00391"></a>00391 <span class="stringliteral">        function call()</span>
<a name="l00392"></a>00392 <span class="stringliteral">        {</span>
<a name="l00393"></a>00393 <span class="stringliteral">                $aArgs = func_get_args();</span>
<a name="l00394"></a>00394 <span class="stringliteral">                return call_user_func_array(array(&amp;$this, 'addScriptCall'), $aArgs);</span>
<a name="l00395"></a>00395 <span class="stringliteral">        }</span>
<a name="l00396"></a>00396 <span class="stringliteral"></span>
<a name="l00404"></a>00404 <span class="stringliteral">        function addRemove($sTarget)</span>
<a name="l00405"></a>00405 <span class="stringliteral">        {</span>
<a name="l00406"></a>00406 <span class="stringliteral">                $this-&gt;addCommand(array('n'=&gt;'rm','t'=&gt;$sTarget),'');</span>
<a name="l00407"></a>00407 <span class="stringliteral">                return $this;</span>
<a name="l00408"></a>00408 <span class="stringliteral">        }</span>
<a name="l00409"></a>00409 <span class="stringliteral">        </span>
<a name="l00410"></a>00410 <span class="stringliteral">        function remove($sTarget)</span>
<a name="l00411"></a>00411 <span class="stringliteral">        {</span>
<a name="l00412"></a>00412 <span class="stringliteral">                return $this-&gt;addRemove($sTarget);</span>
<a name="l00413"></a>00413 <span class="stringliteral">        }</span>
<a name="l00414"></a>00414 <span class="stringliteral"></span>
<a name="l00426"></a>00426 <span class="stringliteral">        function addCreate($sParent, $sTag, $sId, $sType="</span><span class="stringliteral">")</span>
<a name="l00427"></a>00427 <span class="stringliteral">        {</span>
<a name="l00428"></a>00428 <span class="stringliteral">                if ($sType)</span>
<a name="l00429"></a>00429 <span class="stringliteral">                {</span>
<a name="l00430"></a>00430 <span class="stringliteral">                        trigger_error("</span>The \$sType parameter of addCreate has been deprecated.  Use the addCreateInput() method instead.", E_USER_WARNING);
<a name="l00431"></a>00431                         return;
<a name="l00432"></a>00432                 }
<a name="l00433"></a>00433                 $this-&gt;addCommand(array('n'=&gt;'ce','t'=&gt;$sParent,'p'=&gt;$sId),$sTag);
<a name="l00434"></a>00434                 return $this;
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436         
<a name="l00437"></a>00437         function create($sParent, $sTag, $sId, $sType="")
<a name="l00438"></a>00438         {
<a name="l00439"></a>00439                 <span class="keywordflow">return</span> $this-&gt;addCreate($sParent, $sTag, $sId, $sType);
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441 
<a name="l00452"></a>00452         function addInsert($sBefore, $sTag, $sId)
<a name="l00453"></a>00453         {
<a name="l00454"></a>00454                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'ie'</span>,<span class="charliteral">'t'</span>=&gt;$sBefore,<span class="charliteral">'p'</span>=&gt;$sId),$sTag);
<a name="l00455"></a>00455                 <span class="keywordflow">return</span> $this;
<a name="l00456"></a>00456         }
<a name="l00457"></a>00457         
<a name="l00458"></a>00458         function insert($sBefore, $sTag, $sId)
<a name="l00459"></a>00459         {
<a name="l00460"></a>00460                 <span class="keywordflow">return</span> $this-&gt;addInsert($sBefore, $sTag, $sId);
<a name="l00461"></a>00461         }
<a name="l00462"></a>00462 
<a name="l00473"></a>00473         function addInsertAfter($sAfter, $sTag, $sId)
<a name="l00474"></a>00474         {
<a name="l00475"></a>00475                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'ia'</span>,<span class="charliteral">'t'</span>=&gt;$sAfter,<span class="charliteral">'p'</span>=&gt;$sId),$sTag);
<a name="l00476"></a>00476                 <span class="keywordflow">return</span> $this;
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478         
<a name="l00479"></a>00479         function insertAfter($sAfter, $sTag, $sId)
<a name="l00480"></a>00480         {
<a name="l00481"></a>00481                 <span class="keywordflow">return</span> $this-&gt;addInsertAfter($sAfter, $sTag, $sId);
<a name="l00482"></a>00482         }
<a name="l00483"></a>00483         
<a name="l00497"></a>00497         function addCreateInput($sParent, $sType, $sName, $sId)
<a name="l00498"></a>00498         {
<a name="l00499"></a>00499                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'ci'</span>,<span class="charliteral">'t'</span>=&gt;$sParent,<span class="charliteral">'p'</span>=&gt;$sId,<span class="charliteral">'c'</span>=&gt;$sType),$sName);
<a name="l00500"></a>00500                 <span class="keywordflow">return</span> $this;
<a name="l00501"></a>00501         }
<a name="l00502"></a>00502         
<a name="l00503"></a>00503         function createInput($sParent, $sType, $sName, $sId)
<a name="l00504"></a>00504         {
<a name="l00505"></a>00505                 <span class="keywordflow">return</span> $this-&gt;addCreateInput($sParent, $sType, $sName, $sId);
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507 
<a name="l00521"></a>00521         function addInsertInput($sBefore, $sType, $sName, $sId)
<a name="l00522"></a>00522         {
<a name="l00523"></a>00523                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'ii'</span>,<span class="charliteral">'t'</span>=&gt;$sBefore,<span class="charliteral">'p'</span>=&gt;$sId,<span class="charliteral">'c'</span>=&gt;$sType),$sName);
<a name="l00524"></a>00524                 <span class="keywordflow">return</span> $this;
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526         
<a name="l00527"></a>00527         function insertInput($sBefore, $sType, $sName, $sId)
<a name="l00528"></a>00528         {
<a name="l00529"></a>00529                 <span class="keywordflow">return</span> $this-&gt;addInsertInput($sBefore, $sType, $sName, $sId);
<a name="l00530"></a>00530         }
<a name="l00531"></a>00531 
<a name="l00545"></a>00545         function addInsertInputAfter($sAfter, $sType, $sName, $sId)
<a name="l00546"></a>00546         {
<a name="l00547"></a>00547                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'iia'</span>,<span class="charliteral">'t'</span>=&gt;$sAfter,<span class="charliteral">'p'</span>=&gt;$sId,<span class="charliteral">'c'</span>=&gt;$sType),$sName);
<a name="l00548"></a>00548             <span class="keywordflow">return</span> $this;
<a name="l00549"></a>00549         }
<a name="l00550"></a>00550         
<a name="l00551"></a>00551         function insertInputAfter($sAfter, $sType, $sName, $sId)
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553                 <span class="keywordflow">return</span> $this-&gt;addInsertInputAfter($sAfter, $sType, $sName, $sId);
<a name="l00554"></a>00554         }
<a name="l00555"></a>00555 
<a name="l00565"></a>00565         function addEvent($sTarget,$sEvent,$sScript)
<a name="l00566"></a>00566         {
<a name="l00567"></a>00567                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'ev'</span>,<span class="charliteral">'t'</span>=&gt;$sTarget,<span class="charliteral">'p'</span>=&gt;$sEvent),$sScript);
<a name="l00568"></a>00568                 <span class="keywordflow">return</span> $this;
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570 
<a name="l00581"></a>00581         function addHandler($sTarget,$sEvent,$sHandler)
<a name="l00582"></a>00582         {       
<a name="l00583"></a>00583                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'ah'</span>,<span class="charliteral">'t'</span>=&gt;$sTarget,<span class="charliteral">'p'</span>=&gt;$sEvent),$sHandler);
<a name="l00584"></a>00584                 <span class="keywordflow">return</span> $this;
<a name="l00585"></a>00585         }
<a name="l00586"></a>00586 
<a name="l00598"></a>00598         function addRemoveHandler($sTarget,$sEvent,$sHandler)
<a name="l00599"></a>00599         {       
<a name="l00600"></a>00600                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'rh'</span>,<span class="charliteral">'t'</span>=&gt;$sTarget,<span class="charliteral">'p'</span>=&gt;$sEvent),$sHandler);
<a name="l00601"></a>00601                 <span class="keywordflow">return</span> $this;
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603         
<a name="l00604"></a>00604         function removeHandler($sTarget,$sEvent,$sHandler)
<a name="l00605"></a>00605         {
<a name="l00606"></a>00606                 <span class="keywordflow">return</span> $this-&gt;addRemoveHandler($sTarget,$sEvent,$sHandler);
<a name="l00607"></a>00607         }
<a name="l00608"></a>00608 
<a name="l00616"></a>00616         function addIncludeScript($sFileName)
<a name="l00617"></a>00617         {
<a name="l00618"></a>00618                 $this-&gt;addCommand(array(<span class="charliteral">'n'</span>=&gt;<span class="stringliteral">'in'</span>),$sFileName);
<a name="l00619"></a>00619                 <span class="keywordflow">return</span> $this;
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621         
<a name="l00622"></a>00622         function includeScript($sFilename)
<a name="l00623"></a>00623         {
<a name="l00624"></a>00624                 <span class="keywordflow">return</span> $this-&gt;addIncludeScript($sFileName);
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626 
<a name="l00637"></a>00637         function getOutput()
<a name="l00638"></a>00638         {
<a name="l00639"></a>00639                 $xml = <span class="stringliteral">""</span>;
<a name="l00640"></a>00640                 <span class="keywordflow">if</span> (is_array($this-&gt;aCommands))
<a name="l00641"></a>00641                 {
<a name="l00642"></a>00642                         <span class="keywordflow">foreach</span>($this-&gt;aCommands as $aCommand)
<a name="l00643"></a>00643                         {
<a name="l00644"></a>00644                                 $sData = $aCommand[<span class="stringliteral">'data'</span>];
<a name="l00645"></a>00645                                 unset($aCommand[<span class="stringliteral">'data'</span>]);
<a name="l00646"></a>00646                                 $xml .= $this-&gt;_getXMLForCommand($aCommand, $sData);
<a name="l00647"></a>00647                         }
<a name="l00648"></a>00648                 }
<a name="l00649"></a>00649                 
<a name="l00650"></a>00650                 $charSet = <span class="stringliteral">''</span>;
<a name="l00651"></a>00651                 $encoding = <span class="stringliteral">''</span>;
<a name="l00652"></a>00652                 
<a name="l00653"></a>00653                 <span class="keywordflow">if</span> (trim($this-&gt;sEncoding)) {
<a name="l00654"></a>00654                         $charSet = <span class="stringliteral">'; charset="'</span>.$this-&gt;sEncoding.<span class="charliteral">'"'</span>;
<a name="l00655"></a>00655                         $encoding = <span class="stringliteral">' encoding="'</span>.$this-&gt;sEncoding.<span class="charliteral">'"'</span>;
<a name="l00656"></a>00656                 }
<a name="l00657"></a>00657                 
<a name="l00658"></a>00658                 @header(<span class="stringliteral">'content-type: text/xml'</span>.$charSet);
<a name="l00659"></a>00659                 <span class="keywordflow">return</span> <span class="stringliteral">'&lt;?xml version="1.0"'</span>.$encoding.<span class="stringliteral">' ?'</span>.<span class="stringliteral">'&gt;&lt;xjx&gt;'</span>.$xml.<span class="stringliteral">'&lt;/xjx&gt;'</span>;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661         
<a name="l00662"></a>00662         function getXML()
<a name="l00663"></a>00663         {
<a name="l00664"></a>00664                 <span class="keywordflow">return</span> $this;
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666         
<a name="l00679"></a>00679         function loadXML($mCommands)
<a name="l00680"></a>00680         {
<a name="l00681"></a>00681                 <span class="keywordflow">if</span> (is_a($mCommands, <span class="stringliteral">'xajaxResponse'</span>)) {
<a name="l00682"></a>00682                         $this-&gt;aCommands = array_merge($this-&gt;aCommands, $mCommands-&gt;aCommands);
<a name="l00683"></a>00683                 }
<a name="l00684"></a>00684                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_array($mCommands)) {
<a name="l00685"></a>00685                         $this-&gt;aCommands = array_merge($this-&gt;aCommands, $mCommands);
<a name="l00686"></a>00686                 }
<a name="l00687"></a>00687                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_string($mCommands) &amp;&amp; strpos($mXML, <span class="stringliteral">'&lt;xjx&gt;'</span>)!==<span class="keyword">false</span>) {
<a name="l00688"></a>00688                         trigger_error(<span class="stringliteral">"Using xajaxResponse-&gt;loadXML doesn't work with raw XML any more"</span>, E_USER_ERROR);
<a name="l00689"></a>00689                 }
<a name="l00690"></a>00690                 <span class="keywordflow">else</span> {
<a name="l00691"></a>00691                         <span class="keywordflow">if</span> (!empty($mCommands))
<a name="l00692"></a>00692                                 trigger_error(<span class="stringliteral">"The xajax response output could not load other commands as data was not a valid array"</span>, E_USER_ERROR);
<a name="l00693"></a>00693                 }
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695         
<a name="l00696"></a>00696         function loadCommands($mCommands)
<a name="l00697"></a>00697         {
<a name="l00698"></a>00698                 <span class="keywordflow">return</span> $this-&gt;loadXML($mCommands);
<a name="l00699"></a>00699         }
<a name="l00700"></a>00700 
<a name="l00709"></a>00709         function _cmdXML($aAttributes, $sData)
<a name="l00710"></a>00710         {
<a name="l00711"></a>00711                 <span class="keywordflow">if</span> ($this-&gt;bOutputEntities) {
<a name="l00712"></a>00712                         <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">'mb_convert_encoding'</span>)) {
<a name="l00713"></a>00713                                 $sData = call_user_func_array(<span class="stringliteral">'mb_convert_encoding'</span>, array(&amp;$sData, <span class="stringliteral">'HTML-ENTITIES'</span>, $this-&gt;sEncoding));
<a name="l00714"></a>00714                         }
<a name="l00715"></a>00715                         <span class="keywordflow">else</span> {
<a name="l00716"></a>00716                                 trigger_error(<span class="stringliteral">"The xajax XML response output could not be converted to HTML entities because the mb_convert_encoding function is not available"</span>, E_USER_NOTICE);
<a name="l00717"></a>00717                         }
<a name="l00718"></a>00718                 }
<a name="l00719"></a>00719                 $xml = <span class="stringliteral">"&lt;cmd"</span>;
<a name="l00720"></a>00720                 <span class="keywordflow">foreach</span>($aAttributes as $sAttribute =&gt; $sValue)
<a name="l00721"></a>00721                         $xml .= <span class="stringliteral">" $sAttribute=\"$sValue\""</span>;
<a name="l00722"></a>00722                 <span class="keywordflow">if</span> ($sData !== null &amp;&amp; !stristr($sData,<span class="stringliteral">'&lt;![CDATA['</span>))
<a name="l00723"></a>00723                         $xml .= <span class="stringliteral">"&gt;&lt;![CDATA[$sData]]&gt;&lt;/cmd&gt;"</span>;
<a name="l00724"></a>00724                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($sData !== null)
<a name="l00725"></a>00725                         $xml .= <span class="stringliteral">"&gt;$sData&lt;/cmd&gt;"</span>;
<a name="l00726"></a>00726                 <span class="keywordflow">else</span>
<a name="l00727"></a>00727                         $xml .= <span class="stringliteral">"&gt;&lt;/cmd&gt;"</span>;
<a name="l00728"></a>00728                 
<a name="l00729"></a>00729                 <span class="keywordflow">return</span> $xml;
<a name="l00730"></a>00730         }
<a name="l00731"></a>00731         
<a name="l00740"></a>00740         function _getXMLForCommand($aAttributes, $mData)
<a name="l00741"></a>00741         {
<a name="l00742"></a>00742                 $xml = <span class="stringliteral">'&lt;cmd'</span>;
<a name="l00743"></a>00743                 <span class="keywordflow">foreach</span>($aAttributes as $sAttribute =&gt; $sValue)
<a name="l00744"></a>00744                         <span class="keywordflow">if</span> ($sAttribute)
<a name="l00745"></a>00745                                 $xml .= <span class="stringliteral">" $sAttribute=\"$sValue\""</span>;
<a name="l00746"></a>00746                 
<a name="l00747"></a>00747                 <span class="keywordflow">if</span> (is_array($mData)) 
<a name="l00748"></a>00748                         $xml .= <span class="charliteral">'&gt;'</span>.$this-&gt;_arrayToXML($mData).<span class="stringliteral">'&lt;/cmd&gt;'</span>;
<a name="l00749"></a>00749                 <span class="keywordflow">else</span> 
<a name="l00750"></a>00750                         $xml .= <span class="charliteral">'&gt;'</span>.$this-&gt;_escape($mData).<span class="stringliteral">'&lt;/cmd&gt;'</span>;
<a name="l00751"></a>00751                 
<a name="l00752"></a>00752                 <span class="keywordflow">return</span> $xml;
<a name="l00753"></a>00753         }
<a name="l00754"></a>00754         
<a name="l00762"></a>00762         function _arrayToXML($mArray) {
<a name="l00763"></a>00763                 <span class="keywordflow">if</span> (!is_array($mArray))
<a name="l00764"></a>00764                         <span class="keywordflow">return</span> $this-&gt;_escape($mArray);
<a name="l00765"></a>00765                 
<a name="l00766"></a>00766                 $xml = <span class="stringliteral">'&lt;xjxobj&gt;'</span>;
<a name="l00767"></a>00767                 <span class="keywordflow">foreach</span> ($mArray as $aKey=&gt;$aKeyValues) {
<a name="l00768"></a>00768                         <span class="keywordflow">if</span> (is_array($aKeyValues)) {
<a name="l00769"></a>00769                                 $xml .= <span class="stringliteral">'&lt;e&gt;'</span>;
<a name="l00770"></a>00770                                 <span class="keywordflow">foreach</span>($aKeyValues as $sKey =&gt; $sValue) {
<a name="l00771"></a>00771                                         $xml .= <span class="charliteral">'&lt;'</span>.htmlentities($sKey).<span class="charliteral">'&gt;'</span>;
<a name="l00772"></a>00772                                         $xml .= $this-&gt;_arrayToXML($sValue);
<a name="l00773"></a>00773                                         $xml .= <span class="stringliteral">'&lt;/'</span>.htmlentities($sKey).<span class="charliteral">'&gt;'</span>;   
<a name="l00774"></a>00774                                 }
<a name="l00775"></a>00775                                 $xml .= <span class="stringliteral">'&lt;/e&gt;'</span>;
<a name="l00776"></a>00776                         } <span class="keywordflow">else</span> {
<a name="l00777"></a>00777                                 $xml .= <span class="stringliteral">'&lt;e&gt;&lt;k&gt;'</span>;
<a name="l00778"></a>00778                                 $xml .= $this-&gt;_escape($aKey);
<a name="l00779"></a>00779                                 $xml .= <span class="stringliteral">'&lt;/k&gt;&lt;v&gt;'</span>;
<a name="l00780"></a>00780                                 $xml .= $this-&gt;_escape($aKeyValues);
<a name="l00781"></a>00781                                 $xml .= <span class="stringliteral">'&lt;/v&gt;&lt;/e&gt;'</span>;
<a name="l00782"></a>00782                         }
<a name="l00783"></a>00783                 }
<a name="l00784"></a>00784                 $xml .= <span class="stringliteral">'&lt;/xjxobj&gt;'</span>;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786                 <span class="keywordflow">return</span> $xml;
<a name="l00787"></a>00787         }
<a name="l00788"></a>00788         
<a name="l00795"></a>00795         function addCommand($aAttributes, $mData)
<a name="l00796"></a>00796         {
<a name="l00797"></a>00797                 $aAttributes[<span class="stringliteral">'data'</span>] = $mData;
<a name="l00798"></a>00798                 $this-&gt;aCommands[] = $aAttributes;
<a name="l00799"></a>00799         }
<a name="l00800"></a>00800         
<a name="l00809"></a>00809         function _escape($sData)
<a name="l00810"></a>00810         {
<a name="l00811"></a>00811                 <span class="keywordflow">if</span> (!is_numeric($sData) &amp;&amp; !$sData)
<a name="l00812"></a>00812                         <span class="keywordflow">return</span> <span class="stringliteral">''</span>;
<a name="l00813"></a>00813                 
<a name="l00814"></a>00814                 $needCDATA = <span class="keyword">false</span>;
<a name="l00815"></a>00815                 
<a name="l00816"></a>00816                 <span class="keywordflow">if</span> ($this-&gt;bOutputEntities) {
<a name="l00817"></a>00817                         <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">'mb_convert_encoding'</span>))
<a name="l00818"></a>00818                                 trigger_error(<span class="stringliteral">'The xajax response output could not be converted to HTML entities because the mb_convert_encoding function is not available'</span>, E_USER_NOTICE);
<a name="l00819"></a>00819                         
<a name="l00820"></a>00820                         $sData = call_user_func_array(<span class="stringliteral">'mb_convert_encoding'</span>, array(&amp;$sData, <span class="stringliteral">'HTML-ENTITIES'</span>, $this-&gt;sEncoding));
<a name="l00821"></a>00821                 } <span class="keywordflow">else</span> {
<a name="l00822"></a>00822                         <span class="keywordflow">if</span> ((strpos($sData, <span class="stringliteral">'&lt;![CDATA['</span>) !== <span class="keyword">false</span>)
<a name="l00823"></a>00823                         || (strpos($sData, <span class="stringliteral">']]&gt;'</span>) !== <span class="keyword">false</span>)
<a name="l00824"></a>00824                         || (htmlentities($sData) != $sData))
<a name="l00825"></a>00825                                 $needCDATA = <span class="keyword">true</span>;
<a name="l00826"></a>00826                         
<a name="l00827"></a>00827                         $segments = explode(<span class="stringliteral">'&lt;![CDATA['</span>, $sData);
<a name="l00828"></a>00828                         $sData = <span class="stringliteral">''</span>;
<a name="l00829"></a>00829                         <span class="keywordflow">foreach</span> ($segments as $key =&gt; $segment) {
<a name="l00830"></a>00830                                 $fragments = explode(<span class="stringliteral">']]&gt;'</span>, $segment);
<a name="l00831"></a>00831                                 $segment = <span class="stringliteral">''</span>;
<a name="l00832"></a>00832                                 <span class="keywordflow">foreach</span> ($fragments as $fragment) {
<a name="l00833"></a>00833                                         <span class="keywordflow">if</span> ($segment != <span class="stringliteral">''</span>)
<a name="l00834"></a>00834                                                 $segment .= <span class="stringliteral">']]]]&gt;&lt;![CDATA[&gt;'</span>;
<a name="l00835"></a>00835                                         $segment .= $fragment;
<a name="l00836"></a>00836                                 }
<a name="l00837"></a>00837                                 <span class="keywordflow">if</span> ($sData != <span class="stringliteral">''</span>)
<a name="l00838"></a>00838                                         $sData .= <span class="stringliteral">'&lt;![]]&gt;&lt;![CDATA[CDATA['</span>;
<a name="l00839"></a>00839                                 $sData .= $segment;
<a name="l00840"></a>00840                         }
<a name="l00841"></a>00841                 }
<a name="l00842"></a>00842                 
<a name="l00843"></a>00843                 <span class="keywordflow">if</span> ($needCDATA)
<a name="l00844"></a>00844                         $sData = <span class="stringliteral">'&lt;![CDATA['</span>.$sData.<span class="stringliteral">']]&gt;'</span>;
<a name="l00845"></a>00845                 
<a name="l00846"></a>00846                 <span class="keywordflow">return</span> $sData;
<a name="l00847"></a>00847         }
<a name="l00848"></a>00848         
<a name="l00858"></a>00858         function _buildObj($mData) {
<a name="l00859"></a>00859             <span class="keywordflow">if</span> (gettype($mData) == <span class="stringliteral">'object'</span>)
<a name="l00860"></a>00860                         $mData = get_object_vars($mData);
<a name="l00861"></a>00861                 
<a name="l00862"></a>00862             <span class="keywordflow">if</span> (is_array($mData)) {
<a name="l00863"></a>00863                 $aData = array();
<a name="l00864"></a>00864                 <span class="keywordflow">foreach</span> ($mData as $key =&gt; $value)
<a name="l00865"></a>00865                                 $aData[] = array(
<a name="l00866"></a>00866                                         <span class="charliteral">'k'</span>=&gt;$this-&gt;_buildObj($key), 
<a name="l00867"></a>00867                                         <span class="charliteral">'v'</span>=&gt;$this-&gt;_buildObj($value)
<a name="l00868"></a>00868                                 );
<a name="l00869"></a>00869                 <span class="keywordflow">return</span> $aData;
<a name="l00870"></a>00870             } <span class="keywordflow">else</span>
<a name="l00871"></a>00871                         <span class="keywordflow">return</span> $mData;
<a name="l00872"></a>00872         }
<a name="l00873"></a>00873         
<a name="l00874"></a>00874 }<span class="comment">// end class xajaxResponse</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jul 22 11:16:46 2008 for University Scheduling System by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
